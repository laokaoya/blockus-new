# Blockus 方格大战网页游戏 PRD

## 1. 产品概述

### 1.1 产品定位
Blockus方格大战是一款基于经典桌游Blokus的在线多人策略对战网页游戏，支持4人同时在线对战，通过策略性放置拼图块争夺棋盘空间。

### 1.2 目标用户
- 主要用户：18-35岁喜欢策略类游戏的用户
- 次要用户：家庭用户、休闲游戏爱好者
- 使用场景：朋友聚会、在线娱乐、休闲时光

### 1.3 产品目标
- 提供流畅的在线多人游戏体验
- 保持原版Blokus游戏的策略性和趣味性
- 构建活跃的游戏社区
- 月活跃用户目标：10万+

## 2. 游戏核心规则

### 2.1 基本信息
- **游戏人数：** 4人
- **游戏时长：** 15-30分钟/局
### 2.2 游戏道具
- **棋盘：** 20×20灰色方格棋盘
- **拼图块：** 红、黄、蓝、绿四种颜色，每种颜色各21块
- **拼图块组成：**
  - 5格拼图：12块
  - 4格拼图：5块  
  - 3格拼图：2块
  - 2格拼图：1块
  - 1格拼图：1块

### 2.3 拼图块形状（用1代表格子，-代表空格）

- 5块：12个

11111

1111
1---

111
11-

1111
-1--

--1
111
1--

-1-
111
1--

-1-
111
-1-

1--
111
1--

11-
-11
--1

11--
-111

111
1--
1--

1-1
111

- 4块：5个

1111

111
1--

111
-1-

11-
-11

- 3块：2个

111

11
1-

- 2块：1个

11

- 1块：1个

1

### 2.4 游戏流程
1. **初始化阶段**
   - 每位玩家分别拥有一种颜色的所有拼图块（21块）
   - 每位玩家分配棋盘的一个角落作为出发点
   - 随机选定1号玩家开始

2. **游戏进行**
   - 每回合每位玩家依次在棋盘上放置一个拼图块
   - 放置的拼图块视为"占据"覆盖到的格子

### 2.5 放置规则
1. **首次放置：** 必须占据棋盘角落（自己的出发点）
2. **后续放置：** 
   - 拼图必须与己方已占据格子的顶点相连
   - 禁止与己方占据格子的边相连
   - 可以与对手的拼图块边相连或顶点相连
3. **格子占用：** 每个格子只允许占据一次
4. **无法放置：** 玩家可以点击"结算"按钮，之后跳过该玩家的回合

### 2.6 结算规则
- **局内得分：** 计算棋盘上己方占据的所有格子数量
- **游戏结束：** 所有玩家均已结算时游戏结束
- **胜负判定：** 得分最高的玩家获得1局胜利
- **总分记录：** 多局游戏的总分记录在total_score变量中并实时显示

### 2.7 计时规则
- **操作时限：** 每位玩家每次操作限时30秒
- **倒计时显示：** UI实时显示倒计时
- **超时处理：** 倒计时结束未操作则自动跳过该回合
- **连续超时：** 连续超时两回合则该玩家自动进入结算流程

## 3. 交互设计

### 3.1 操作方式
1. **拼图选择**
   - 玩家可查看自己还未放置的所有拼图块和序号
   - 点击特定拼图后跟随鼠标移动

2. **拼图放置**
   - 拼图在棋盘上且能够放置时，相应位置发亮提示
   - 再次点击即可放置拼图
   - 放置后弹出确认框（√确认 / ×取消）

3. **拼图撤回**
   - 在棋盘外点击为"放回拼图"
   - 拼图退回原始位置，不再跟随鼠标
   - 已放置在棋盘的拼图不可撤回

### 3.2 辅助功能
- **拼图旋转：** 右键点击或特定按键旋转拼图
- **拼图翻转：** 支持水平/垂直翻转
- **预览模式：** 半透明显示可放置位置
- **撤销功能：** 确认前可撤销当前操作

## 4. UI界面设计

### 4.1 设计原则
- 符合Apple标准设计规范
- 风格简约大气，方便操作
- 响应式设计，支持多设备
- 色彩搭配友好，支持色盲用户

### 4.2 界面层级

#### 4.2.1 登录界面
- **功能：** 用户注册/登录，社交账号登录
- **元素：** Logo、登录表单、注册链接、忘记密码
- **特色：** 游戏主题背景，简洁表单设计

#### 4.2.2 主界面（大厅）
- **功能：** 游戏模式选择、个人信息、排行榜
- **布局：**
  - 顶部：用户头像、昵称、等级、总积分
  - 中部：快速匹配、创建房间、加入房间按钮
  - 底部：排行榜、设置、帮助按钮
- **特色：** 卡片式布局，清晰的功能分区

#### 4.2.3 房间界面
- **功能：** 房间设置、玩家状态、准备开始
- **布局：**
  - 左侧：房间信息（房间号、规则设置）
  - 中部：4个玩家位置，显示头像、昵称、准备状态
  - 右侧：聊天区域
  - 底部：准备按钮、离开房间按钮

#### 4.2.4 游戏加载界面
- **功能：** 游戏初始化、玩家信息展示
- **元素：** 加载进度条、玩家头像环形排列、游戏提示
- **时长：** 3-5秒加载时间

#### 4.2.5 游戏对战界面
- **布局结构：**
  ```
  ┌─────────────────────────────────────────────────────┐
  │ 顶部状态栏：回合指示、倒计时、暂停菜单               │
  ├─────────────────────────────────────────────────────┤
  │ 左侧：当前玩家拼图库 │ 中央：20×20游戏棋盘 │ 右侧：对手信息 │
  │ - 按类型分组显示     │ - 网格布局          │ - 头像昵称     │
  │ - 剩余数量提示       │ - 颜色区分          │ - 剩余拼图数   │
  │ - 可拖拽操作         │ - 放置位置高亮      │ - 得分显示     │
  └─────────────────────────────────────────────────────┤
  │ 底部：操作提示、结算按钮、聊天快捷消息               │
  └─────────────────────────────────────────────────────┘
  ```

- **交互细节：**
  - 拼图库：按5格、4格、3格、2格、1格分类展示
  - 棋盘：网格清晰，已占据格子显示对应颜色
  - 当前回合玩家高亮显示，非当前回合玩家灰色显示
  - 鼠标悬浮显示可放置位置的半透明预览

#### 4.2.6 结算界面
- **功能：** 单局结果、积分变化、继续游戏选项
- **布局：**
  - 中央：得分排行，显示每个玩家的格子数和排名
  - 底部：再来一局、返回大厅、分享结果按钮
- **动效：** 分数统计动画，排名变化动效

#### 4.2.7 个人信息界面
- **功能：** 用户资料、游戏统计、设置选项
- **内容：**
  - 个人资料：头像、昵称、等级、总积分
  - 游戏统计：总局数、胜率、平均得分、连胜记录
  - 设置选项：音效、音乐、画质、语言设置

### 4.3 响应式设计
- **桌面端（1920×1080）：** 三栏布局，充分利用屏幕空间
- **平板端（1024×768）：** 两栏布局，拼图库可折叠
- **手机端（375×667）：** 单栏布局，拼图库底部抽屉式展示

## 5. 技术实现

### 5.1 技术架构
- **前端框架：** React + TypeScript
- **状态管理：** Redux Toolkit
- **UI组件库：** Ant Design + 自定义组件
- **实时通信：** Socket.io
- **构建工具：** Vite
- **代码质量：** ESLint + Prettier

### 5.2 后端技术栈
- **服务端：** Node.js + Express
- **数据库：** MongoDB + Redis（缓存）
- **实时通信：** Socket.io
- **身份验证：** JWT + Passport.js
- **部署：** Docker + Nginx

### 5.3 核心模块
1. **用户系统**
   - 注册/登录/OAuth
   - 用户信息管理
   - 积分等级系统

2. **房间系统**
   - 房间创建/加入/离开
   - 房间状态同步
   - 玩家匹配

3. **游戏引擎**
   - 游戏状态管理
   - 拼图放置验证
   - 回合控制
   - 结算计算

4. **实时通信**
   - WebSocket连接管理
   - 游戏状态广播
   - 断线重连

### 5.4 数据结构设计

#### 5.4.1 用户数据
```javascript
{
  userId: String,
  username: String,
  avatar: String,
  level: Number,
  totalScore: Number,
  gamesPlayed: Number,
  gamesWon: Number,
  createdAt: Date
}
```

#### 5.4.2 游戏房间数据
```javascript
{
  roomId: String,
  players: [
    {
      userId: String,
      username: String,
      color: String, // 'red', 'yellow', 'blue', 'green'
      isReady: Boolean,
      isConnected: Boolean
    }
  ],
  gameState: String, // 'waiting', 'playing', 'finished'
  currentPlayer: Number, // 0-3
  timeLeft: Number,
  createdAt: Date
}
```

#### 5.4.3 游戏状态数据
```javascript
{
  board: Array[20][20], // 棋盘状态，0=空，1-4=玩家颜色
  players: [
    {
      userId: String,
      pieces: [
        {
          id: String,
          shape: Array[],
          isUsed: Boolean
        }
      ],
      score: Number,
      isSettled: Boolean
    }
  ],
  currentTurn: Number,
  turnTimeLimit: Number,
  gamePhase: String // 'playing', 'settling', 'finished'
}
```

### 5.5 API设计

#### 5.5.1 用户相关API
```
POST /api/auth/register     # 用户注册
POST /api/auth/login        # 用户登录
GET  /api/user/profile      # 获取用户信息
PUT  /api/user/profile      # 更新用户信息
GET  /api/user/stats        # 获取游戏统计
```

#### 5.5.2 房间相关API
```
POST /api/room/create       # 创建房间
POST /api/room/join         # 加入房间
POST /api/room/leave        # 离开房间
GET  /api/room/list         # 获取房间列表
```

#### 5.5.3 游戏相关API
```
POST /api/game/place-piece  # 放置拼图
POST /api/game/settle       # 结算
GET  /api/game/state        # 获取游戏状态
POST /api/game/timeout      # 超时处理
```

### 5.6 性能优化
- **前端优化：**
  - 组件懒加载
  - 虚拟滚动
  - 图片懒加载
  - 代码分割

- **后端优化：**
  - Redis缓存游戏状态
  - 数据库连接池
  - API限流
  - CDN静态资源

### 5.7 安全考虑
- **数据验证：** 前后端双重验证
- **反作弊：** 服务端游戏逻辑验证
- **DDoS防护：** 限流和黑名单
- **数据加密：** HTTPS + 敏感数据加密

## 6. 功能需求

### 6.1 用户故事

#### 6.1.1 新用户注册登录
- **作为** 新用户
- **我希望** 能够快速注册账号并登录游戏
- **以便于** 开始我的游戏体验
- **验收标准：**
  - 支持邮箱/手机号注册
  - 支持第三方账号登录（微信、QQ、Apple ID）
  - 注册流程不超过3步
  - 登录响应时间<2秒

#### 6.1.2 快速匹配游戏
- **作为** 玩家
- **我希望** 能够快速找到其他玩家开始游戏
- **以便于** 不用等待太长时间
- **验收标准：**
  - 匹配时间<30秒
  - 支持按等级匹配
  - 支持重新匹配功能
  - 显示匹配进度

#### 6.1.3 创建私人房间
- **作为** 玩家
- **我希望** 能够创建房间邀请朋友
- **以便于** 和认识的人一起游戏
- **验收标准：**
  - 生成房间号便于分享
  - 支持房间密码设置
  - 房主可以踢出玩家
  - 支持观战模式

#### 6.1.4 游戏过程体验
- **作为** 玩家
- **我希望** 游戏操作简单直观
- **以便于** 专注于策略思考
- **验收标准：**
  - 拖拽操作流畅无卡顿
  - 可放置位置清晰提示
  - 支持拼图旋转翻转
  - 操作可撤销（确认前）

#### 6.1.5 查看游戏记录
- **作为** 玩家
- **我希望** 能够查看历史战绩
- **以便于** 跟踪自己的进步
- **验收标准：**
  - 显示详细对局记录
  - 提供数据统计图表
  - 支持分享精彩对局
  - 可查看对手信息

### 6.2 功能优先级

#### 6.2.1 P0（必须实现）
1. 用户注册登录系统
2. 核心游戏玩法
3. 房间匹配系统
4. 基础UI界面
5. 实时通信

#### 6.2.2 P1（重要功能）
1. 用户等级积分系统
2. 游戏统计数据
3. 聊天功能
4. 音效音乐
5. 响应式布局

#### 6.2.3 P2（优化功能）
1. 观战模式
2. 回放系统
3. 排行榜
4. 成就系统
5. 皮肤主题

#### 6.2.4 P3（未来功能）
1. 锦标赛模式
2. AI对战
3. 社交功能
4. 直播功能
5. 付费道具

### 6.3 性能指标
- **页面加载时间：** <3秒
- **游戏响应延迟：** <100ms
- **同时在线用户：** 支持10,000+
- **服务可用性：** 99.9%
- **移动端兼容：** iOS 12+, Android 8+

## 7. 业务逻辑

### 7.1 用户成长体系
- **等级系统：** 基于游戏局数和胜率的综合等级
- **积分规则：**
  - 胜利：+10分
  - 第二名：+5分
  - 第三名：+2分
  - 第四名：+1分
  - 连胜奖励：连胜3局额外+5分，连胜5局额外+10分
- **等级奖励：** 每提升一个等级获得头像框、称号等奖励

### 7.2 房间管理
- **房间生命周期：**
  1. 创建房间 → 等待玩家
  2. 玩家准备 → 游戏开始
  3. 游戏进行 → 游戏结束
  4. 结算显示 → 房间解散/继续
- **房间权限：**
  - 房主：踢人、开始游戏、房间设置
  - 成员：准备、聊天、离开
- **掉线处理：**
  - 游戏中掉线60秒内可重连
  - 超时未重连视为主动结算

### 7.3 匹配算法
- **快速匹配：**
  1. 优先匹配相近等级玩家（±2级）
  2. 等待时间超过30秒扩大等级范围（±5级）
  3. 等待时间超过60秒匹配任意等级
- **房间匹配：**
  - 显示当前可加入的房间列表
  - 按房间创建时间排序
  - 支持按等级筛选

### 7.4 反作弊机制
- **服务端验证：**
  - 所有拼图放置都在服务端验证合法性
  - 操作时间限制在服务端严格控制
  - 游戏状态只能通过合法API修改
- **异常检测：**
  - 监控异常快速操作
  - 检测重复断线重连
  - 分析游戏行为模式

### 7.5 数据统计
- **玩家数据：**
  - 总游戏局数、胜利局数、胜率
  - 平均每局得分、最高得分
  - 使用拼图块统计、偏好分析
  - 游戏时长统计
- **系统数据：**
  - DAU/MAU统计
  - 房间创建/加入数据
  - 游戏完成率
  - 用户留存数据

## 8. 项目规划

### 8.1 开发阶段

#### 8.1.1 MVP版本（4周）
- **Week 1-2：** 基础架构搭建
  - 前后端项目初始化
  - 用户系统开发
  - 基础UI框架
- **Week 3-4：** 核心游戏功能
  - 游戏逻辑实现
  - 房间系统
  - 基础对战界面

#### 8.1.2 Beta版本（6周）
- **Week 5-6：** 功能完善
  - 实时通信优化
  - 游戏体验优化
  - UI/UX完善
- **Week 7-8：** 测试与优化
  - 压力测试
  - 用户体验测试
  - 性能优化
- **Week 9-10：** 上线准备
  - 部署环境搭建
  - 监控告警系统
  - 用户反馈收集

#### 8.1.3 正式版本（持续迭代）
- 用户反馈优化
- 新功能开发
- 性能持续优化
- 运营活动支持

### 8.2 团队配置
- **产品经理：** 1人（需求管理、用户体验）
- **前端开发：** 2人（React开发、UI实现）
- **后端开发：** 2人（Node.js开发、数据库设计）
- **UI设计师：** 1人（界面设计、交互设计）
- **测试工程师：** 1人（功能测试、性能测试）

### 8.3 风险评估
- **技术风险：**
  - 实时通信稳定性
  - 高并发处理能力
  - 移动端性能优化
- **产品风险：**
  - 用户接受度
  - 竞品冲击
  - 运营推广效果
- **业务风险：**
  - 服务器成本控制
  - 用户留存率
  - 变现模式验证

## 9. 运营策略

### 9.1 用户获取
- **推广渠道：**
  - 社交媒体营销
  - 游戏社区推广
  - 朋友推荐奖励
- **内容营销：**
  - 游戏攻略教程
  - 精彩对局视频
  - 社区运营

### 9.2 用户留存
- **每日任务：** 登录奖励、对局任务
- **周期活动：** 排位赛、主题比赛
- **社交功能：** 好友系统、公会功能

### 9.3 商业模式
- **基础功能：** 完全免费
- **付费道具：**
  - 个性化皮肤
  - 特殊头像框
  - VIP特权功能
- **广告收入：** 非强制性激励视频广告

---

*本PRD文档版本：v1.0*  
*最后更新时间：2024年*  
*文档负责人：产品团队*
